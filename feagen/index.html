<!DOCTYPE html>
<html>
<head>
    <title>Feagen - Insight BDD Test</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

	<!--menu label setting -->
	<script src="js/menu.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
	<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
	<!--angular js-->
	<!--script src="http://apps.bdimg.com/libs/angular.js/1.3.9/angular.min.js"></script-->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>

	<style>
	.featureSolidRed {
		border: 5px solid red;
	}
	.featureSolidGreen {
		border: 5px solid green;
	}
	.list-group{
		word-wrap: break-word;
		word-break: normal;
		height: 295px;
		overflow: auto;
	}
	div.panel{
		width:300px;
		position:relative;
		left:13px;
		padding-right:0px;
		padding-left:0px;
	}

	</style>

	<script>
		//var globalFolder = "C:/git/nodeWebkit/feagen";
		//var path = require('path');
		//var globalFolder = path.dirname(process.execPath);
		//console.log("globalFolder: "+globalFolder);

		var globalFolder = process.cwd();
		console.log("globalFolder: "+globalFolder);

		var myApp1;
		myApp1 = myApp1 || (function () {
			var pleaseWaitDiv = $('<div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-header"><h1>Processing...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></div>');
			return {
				showPleaseWait: function() {
					pleaseWaitDiv.modal();
				},
				hidePleaseWait: function () {
					pleaseWaitDiv.modal('hide');
				},

			};
		})();

		/*$(function() {
			$( "#mysort1, #mysort2").sortable({
	            connectWith: "#mysort3"
			});
			$( "#mysort3").sortable({
				out: function( event, ui ) {

				}
			});
		});*/

		//step modal
		function stepModal()
		{
			var flag;
			var regularExpress;
			var linkTo;
			var methodName;
		}

		function codeAnalyze(currentPath){
			var fs = require('fs');

			var traverseFileSystem = function (currentPath) {
				//console.log(currentPath);
				var files = fs.readdirSync(currentPath);
				//console.log(files);
				for (var i in files) {
					var currentFile = currentPath + '/' + files[i];
					var stats = fs.statSync(currentFile);
					if (stats.isFile()) {
						//console.log(currentFile);
						var myRegexp6 = /.*Step\.java/g;
						var matchMethod6 = myRegexp6.exec(currentFile);
						if(matchMethod6){
							//alert(files.length);
							console.log("%%%%%%%%%%%%%%%%%% "+files[i]+" %%%%%%%%%%%%%%%%% "+matchMethod6);
							//readFile(currentFile, "C:/git/nodeWebkit/feagen/temp/"+files[i].substring(0, files[i].length-5)+".json");
							var tempFile = globalFolder + "/temp/"+files[i].substring(0, files[i].length-5)+".json";
							readFile(currentFile, tempFile);
						}
					} else if (stats.isDirectory()) {
						 traverseFileSystem(currentFile);
					}
				}
			};
			traverseFileSystem(currentPath);

			alert('Complete the code analyze!');
			//angular.element($('#stepOptions')).scope().updateModel("C:/git/nodeWebkit/feagen/temp/"+linkTo+".json");
			//angular.element($('#stepOptions')).scope().options("C:/git/nodeWebkit/feagen/temp"); //refresh the options
			//var tempJson = globalFolder + "/temp";
			//angular.element($('#stepOptions')).scope().options(tempJson); //refresh the options
			angular.element($('#stepOptions')).scope().updateOptions();
			/*angular.element($('#stepOptions')).scope().options = [
			  {path:"C:/Users/ryang/AppData/Local/Temp/nw12404_32243/temp/CompanyProfilePageStep.json", abbr:"CompanyProfilePageStep"},
			  {path:"C:/Users/ryang/AppData/Local/Temp/nw12404_32243/temp/DashboardSearchPageStep.json", abbr:"DashboardSearchPageStep"},
			  {path:"C:/Users/ryang/AppData/Local/Temp/nw12404_32243/temp/DisclosureSearchPageStep.json", abbr:"DisclosureSearchPageStep"},
			  {path:"C:/Users/ryang/AppData/Local/Temp/nw12404_32243/temp/HomePageStep.json", abbr:"HomePageStep"}
			]	*/
		}
		/*function traverseFileSystem(currentPath){
			//console.log(currentPath);
			var files = fs.readdirSync(currentPath);
			for (var i in files) {
				var currentFile = currentPath + '/' + files[i];
				var stats = fs.statSync(currentFile);
				if (stats.isFile()) {
					//console.log(currentFile);
					var myRegexp6 = /.*Step\.java/g;
					var matchMethod6 = myRegexp6.exec(currentFile);
					if(matchMethod6){
						console.log("%%%%%%%%%%%%%%%%%% "+files[i]+" %%%%%%%%%%%%%%%%% "+matchMethod6);
						readFile(currentFile, "C:/git/nodeWebkit/feagen/temp/"+files[i].substring(0, files[i].length-5)+".json");
					}
				} else if (stats.isDirectory()) {
					 traverseFileSystem(currentFile);
				}
			}
		}*/

		//analyze the *step.java file
		function readFile(path, output){
			var fs = require('fs');
			var regexArray = new Array();

			var codeArray = fs.readFileSync(path).toString().split('\n');
			//console.log(codeArray);
			for(var i = 0, l = codeArray.length; i < l; i++) {
				var smodal = new stepModal();

				//console.log(codeArray[i]);

				var myRegexp = /(\s*)(@When|@Then|@Given|@And)(.*)/g;
				var matchLine = myRegexp.exec(codeArray[i]);
				if(matchLine!=null){
					console.log("Get Sentence: "+codeArray[i]);

					var a1 = matchLine[2];
					var a2 = matchLine[3];
					console.log("Flag: "+a1.substring(1));

					smodal.flag = a1.substring(1);

					var myRegexp2 = /(\(\"\^)(.*)(\$\"\))/g;
					var matchRegu = myRegexp2.exec(a2);
					console.log("Regular Express: "+matchRegu[2]);
					smodal.regularExpress = matchRegu[2];

					mode = "methodMode";
					i++;

					while(i < l){
						if(codeArray[i].trim().length>1){
							console.log("Get Sentence: "+codeArray[i]);
							var myRegexp3 = /(\s*)([0-9a-zA-Z]*)(\s*)([0-9a-z_A-Z]*)(\(.*\))/g;
							var matchMethod = myRegexp3.exec(codeArray[i]);

							var linkTo = matchMethod[2]+"Step";
							console.log("LinkTo: "+linkTo);
							smodal.linkTo = linkTo;

							var methodName = matchMethod[4];
							console.log("Method Name: "+methodName);
							smodal.methodName = methodName;

							console.log(" ");

							break;
						}
						i++;
					}
					regexArray.push(smodal);
				}
			}

			/*
			var myarray = [];
			var myJSON = "";

			for (var i = 0; i < 10; i++) {

				var item = {
					"value": i+"aa",
					"label": i+"xx"
				};

				myarray.push(item);
			}
			console.log(myarray);
			myJSON = JSON.stringify({myarray: myarray});
			alert(myJSON); */

			/*
			var student = new Object();
			student.flag = "5485891512";
			student.linkTo = "Lanny";
			student.methodName = 25;
			student.regularExpress = "sdfsdgsdg";

			var sm = new Array();
			sm[0] = "flag";
			sm[1] = "linkTo";
			sm[2] = "methodName";
			sm[3] = "regularExpress";

			var testArray = new Array();
			testArray[0] = "aa";
			testArray[1] = "bb";
			testArray[2] = "cc";
			alert(JSON.stringify(student, sm)); */

			//console.log(regexArray);
			var myJsonString = JSON.stringify(regexArray);
			console.log(myJsonString);

			//var path = require('path');
			//console.log("console.log(process.cwd()): "+process.cwd());
			//console.log("process.execPath: "+process.execPath);

			//var tempFile = "C:/git/nodeWebkit/feagen/temp/test.json";
			//var tempFile = globalFolder + "/temp/test.json";
			var tempFile = output;
			fs.writeFile(tempFile, myJsonString, function (err) {
				if (err) throw err;
				console.log("Export Account Success!");
			});

			//setbehaviorCtrl("");
		}

		//angular js inject data
		var myAppModule = angular.module('myApp', []);
		var datactrl = function behaviorController($http,$scope,$timeout) {
			//initial data display
			//$http.get(globalFolder+"/temp/loginPageStep.json").success(function(data) {
			var defaultStartPage = globalFolder+"/temp/loginPageStep.json";
			/*$http.get(defaultStartPage).success(function(data) {
				$scope.data = data;
				console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
				console.log(data);
				//console.log(JSON.stringify(data));
			});		*/

			$scope.updateModel = function(choosen) {
				//$http.get("C:/Users/XIN/Desktop/node webkit/myNodeWebkitApps/feagen/temp/test.json").success(function(data) {
				$http.get(choosen).success(function(data) {
					$scope.selected_id = choosen;
					$scope.data = data;
					//console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"+$scope.selected_id);
					console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"+choosen);
					setTimeout('enableDragAndDrop()',200); //must add the timeout, no update real time, it is stupid
				});
				/*$http.get(choosen).then(function(response) {
					$scope.data = response.data;
					console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"+choosen);
					//$scope.$digest;
					setTimeout('enableDragAndDrop()',100); //must add the timeout, no update real time, it is stupid
					// success handler
				}, function(response) {
					console.log("???????????????????????????????????????????????????"+choosen);
					// error handler
				});	*/
			};
			//$scope.options = walk(globalFolder+"/temp");
			//$scope.options = optionRefresh();
			$scope.options = [];

			$scope.updateOptions = function(){
				$scope.options = optionRefresh();
				console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"+defaultStartPage);
				$scope.$apply();
				$http.get(defaultStartPage).success(function(data) {
					$scope.selected_id = defaultStartPage;
					$scope.data = data;
					console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"+$scope.selected_id);
					setTimeout('enableDragAndDrop()',200); //must add the timeout, no update real time, it is stupid
				});
			};

			$scope.applyAll = function(){
				$scope.$apply();
			}
			
			// custom filter to get behavior, show both 'When' and 'And' content
			$scope.behaviorFilter = function(jsondata) {
				return jsondata.flag === "When" || jsondata.flag === "And";
			};

			//get total file list here
			/*$scope.options = [
			  {path:1, abbr:'Starbuck'},
			  {path:2, abbr:'Appolo'},
			  {path:3, abbr:'Saul Tigh'},
			  {path:4, abbr:'Adama'}
			]*/
		}
		myAppModule.controller('stepController', datactrl);

		function optionRefresh() {
			console.log("##################################");
			var fileList = walk(globalFolder+"/temp");
			var xxList = [];
			for(i=0;i<fileList.length;i++){
				var xxdata ={};

				//var myRegexp6 = /.*Step\.java/g;
				//C:/git/nodeWebkit/feagen/temp/CompanyProfilePageStep.json

				var myRegexp = /(.*)(\/)([0-9a-zA-Z]+Step)(\.json)/g;
				var matchMethod = myRegexp.exec(fileList[i]);
				console.log(fileList[i]);
				if(matchMethod){
					console.log("%%%%%%%%%%%%%%%%%% "+fileList[i]+" %%%%%%%%%%%%%%%%% "+matchMethod[3]);
					xxdata.abbr = matchMethod[3];
				} else {
					xxdata.abbr = "not matched";
				}
				//xxdata.abbr = fileList[i].toString().substring(fileList[i].length-10);

				xxdata.path = fileList[i];
				xxList.push(xxdata);
			}
			//var myJsonString = JSON.stringify(xxList);
			//console.log(myJsonString);
			console.log("====================test option list==========================");
			console.log(xxList);
			return xxList;
		}
		//search the current folder
		function walk(path){
			var fs = require('fs');
			var fileList = [];
			var dirList = fs.readdirSync(path);
			dirList.forEach(function(item){
				if(fs.statSync(path + '/' + item).isDirectory()){

				}else{
					fileList.push(path + '/' + item);
					//fileList.push(item);
				}
			});
			return fileList;
		}

		//var xxx = walk('C:/Users/XIN/Desktop/node webkit/myNodeWebkitApps/feagen/temp');
		//console.log(xxx);

		function setbehaviorCtrl(path){
			$("#behaviors li").each(function() {
				$(this).remove();
			});
		}

		/*myAppModule.controller('assertController', function($scope) {
			$scope.data = [
				{name:'Jani',country:'Norway'},
				{name:'Hege',country:'Sweden'},
				{name:'Kai',country:'Denmark'}
			];
		});*/

		function enableDragAndDrop(){
			$( "#behaviors" ).accordion();
			$( "#behaviors li" ).draggable({
			  appendTo: "body",
			  helper: "clone"
			});

			$( "#asserts" ).accordion();
			$( "#asserts li" ).draggable({
			  appendTo: "body",
			  helper: "clone"
			});

			//api: http://api.jqueryui.com/droppable/#event-over
			$( "#featureSteps ol" ).droppable({
			  activeClass: "featureSolidRed",
			  hoverClass: "featureSolidGreen",
			  accept: ":not(.ui-sortable-helper)",
			  drop: function( event, ui ) {
				//$( this ).find( ".placeholder" ).remove();
				//$( "<li class='list-group-item'></li>" ).text( ui.draggable.text() ).appendTo( this );
				//console.info('ui.draggable.attr("regularExpress"):' + ui.draggable.attr('regularExpress'));
				var regularExpress = ui.draggable.attr('regularExpress');
				//regularExpress = reStringClean(regularExpress);
				var reStr = " regularExpress='"+regularExpress+"' ";
				var flag = ui.draggable.attr('flag');
				var flStr = " flag='"+flag+"' ";
				var linkTo = ui.draggable.attr('linkTo');
				var linkStr = " linkTo='"+linkTo+"' ";
				var completeStep = regularExpress;
				completeStep = reStringClean(completeStep);
				var csStr = " completeStep='"+completeStep+"' ";
				var str = "<li class='list-group-item'"+reStr+flStr+csStr+"></li>"
				console.info("str: "+str);
				var uiText = reStringClean(ui.draggable.text());
				$(str).text(uiText).appendTo( this );
				//$(str).text( ui.draggable.text() ).appendTo( this );
				//$( "<li class='list-group-item'></li>" ).text( ui.draggable.text() ).appendTo( this );
				//$( "<li class='list-group-item' ng-repeat='x in data' flag='{{x.flag}}' methodName='{{x.methodName}}' regularExpress={{x.regularExpress}} linkTo={{x.linkTo}}></li>" ).text( ui.draggable.text() ).appendTo( this );

				//call scope from outside
				//angular.element($('#stepOptions')).scope().updateModel("C:/git/nodeWebkit/feagen/temp/loginPageStep.json");
				//$('#stepOptions option').removeAttr('selected')
				//$("#stepOptions option[label="+linkTo).prop("selected", true);
				//angular.element($('#stepOptions')).scope().updateModel("C:/git/nodeWebkit/feagen/temp/"+linkTo+".json");
				var linkToJson = globalFolder + "/temp/" + linkTo + ".json";
				angular.element($('#stepOptions')).scope().updateModel(linkToJson);
				angular.element($('#stepOptions')).scope().applyAll();
				//angular.element($('#stepOptions')).scope().updateModel(angular.element($('#stepOptions')).scope().selected_id);

				if(completeStep.indexOf("(.*?)") >= 0 ){
					var count = completeStep.match(/"(.*?)"/g).length;
					$('#replaceLocator').empty();
					//alert(count);
					for(var i=0;i<count;i++){
						$('#replaceLocator').append('<input type="text" class="form-control" placeholder="Replace the word '+i+'">');
					}
					var highLightStr = completeStep.replace(/"(.*?)"/g, '<font color="red">"(.*?)"</font>');
					$('#highlightStr').remove();
					$('#reModalHeader').append("<p id='highlightStr'>"+highLightStr+"</p>");
					$("#reModal").modal();
					//alert(count);
				}
			  }
			}).sortable({
			  //items: "li:not(.placeholder)",
			  sort: function() {
				// gets added unintentionally by droppable interacting with sortable
				// using connectWithSortable fixes this, but doesn't allow you to customize active/hoverClass options
				//$( this ).removeClass( "ui-state-default" );
				$( this ).removeClass( "featureSolidRed" );
			  }
			});
		}

		function reStringClean(txt){
			var s = txt.replace(/\\/g, "");
			return s;
		}

		function handleRegularExpressString(){
			var str = $("#featureSteps ol li:last-child" ).attr('completeStep');
			var txt = $("#featureSteps ol li:last-child" ).text();

			$("#replaceLocator input" ).each(function( index ) {
				console.log( index + ": " + $( this ).val() );
				var temp = '"'+$(this).val()+'"';
				console.log(temp);
				str = str.replace(/"(.*?)"/g, temp);
				txt = txt.replace(/"(.*?)"/g, temp).substring(0,60);
			});

			//str = str.replace(/"(.*?)"/g, s);
			//txt = txt.replace(/"(.*?)"/g, s);
			$("#featureSteps ol li:last-child" ).attr('completeStep', str);
			$("#featureSteps ol li:last-child" ).text(txt);
			 $('#reModal').modal('toggle');
		}

		function generateFeature(){
			//alert("aaa");
			var txt = "";
			var tag = "@ui\n";
			var featureSample = "Feature: test line 1\n"
							+ "  test line 2\n"
							+ "  i want test line 3\n";
			var scenarioSample = "  Scenario: insight_test\n";
			txt += tag;
			txt += featureSample;
			txt += scenarioSample;
			$("#featureSteps ol li").each(function (index) {
				//if(index == 0) return true;
				console.log(index + ":cccccccccccccccc:" + $(this).text());
				console.log(index + ":dddddddddddddddd:" + $(this).attr("regularexpress"));
				console.log(index + ":eeeeeeeeeeeeeeee:" + $(this).attr("completeStep"));
				txt += "    " + $(this).attr("flag") + " " + $(this).attr("completeStep") + "\n";
				/*if ($(this).text != undefined) {
					console.log("cccccccccccccccc"+$(this).text);
				}*/
			});
			$("textarea#featureText").val(txt);
			//featureText
		}

		function runTest(){
			console.log("run Test");

			var optionTexts = [];
			$("#featureSteps ol li").each(function() {
				//optionTexts.push($(this).attr("regularExpress"));
				optionTexts.push($(this));
			});

			console.log(optionTexts);

			/*var featureOutput = "";
			featureOutput += "@ui\n";
			featureOutput += "Feature: Benchmarking (TrueView) sales demo\n";
			featureOutput += "  Scenario: Equilar user login and show the customer TrueView demo\n";
			for(i=0;i<optionTexts.length;i++){
				featureOutput+= "     ";
				featureOutput+= optionTexts[i].attr("flag");
				featureOutput+= " ";
				featureOutput+= optionTexts[i].attr("completeStep");
				featureOutput+= "\n";
			}*/
			var featureOutput = $("textarea#featureText").val();

			var fs = require('fs');
			var projectRoot = $('#upload-file-info').val();
			//var tempFile = "C:/git/nodeWebkit/feagen/temp/xxx.feature";
			var tempFile = globalFolder+"/temp/xxx.feature";
			//var targetFilePath = "src/test/resources/features/xxx.feature";
			//var targetFile = projectRoot + '/'+ targetFilePath;
			//src/test/resources/features/GovernanceP4P.feature
			//fs.createReadStream(tempFile).pipe(fs.createWriteStream(targetFile));
			//fs.writeFileSync(targetFile, fs.readFileSync(tempFile));
			//copyFile(tempFile, targetFile);

			fs.writeFile(tempFile, featureOutput, function (err) {
				if (err) throw err;
				console.log("Export Account Success!");
			});

			//fs.createReadStream(tempFile).pipe(fs.createWriteStream(targetFile));

			//myCmd1 = 'cd apache-maven-3.3.3/bin';
			//execCmd(myCmd1);			
			//myCmd2 = '/apache-maven-3.3.3/bin/mvn -f '+projectRoot+' -Denv=demo -Dbrowser=chrome -Pdevelopment -Dcucumber.options="C:\Users\XIN\Desktop\node webkit\insight-bdd-testing\src\test\resources\features\GovernanceP4P.feature" -Dforks=1 test';
			myCmd2 = globalFolder+'/apache-maven-3.3.3/bin/mvn -f '+projectRoot+' -Denv=demo -Dbrowser=chrome -Pdevelopment -Dcucumber.options="'+tempFile+'" -Dforks=1 test';
			//myCmd2 = '/apache-maven-3.3.3/bin/mvn -f '+projectRoot+' -Denv=demo -Dbrowser=chrome -Pdevelopment -Dcucumber.options="--tags @p4p" -Dforks=1 test';
			//myCmd2 = 'mvn -f C:\git\nodeWebkit\insight-bdd-testing -Denv=stage -Dbrowser=chrome -Pdevelopment -Dcucumber.options="--tags @p4p" -Dforks=1 test';
			//myCmd2 = '/apache-maven-3.3.3/bin/mvn -f C:\git\nodeWebkit\insight-bdd-testing -Denv=stage -Dbrowser=chrome -Pdevelopment -Dcucumber.options="--tags @p4p" -Dforks=1 test';
			execCmd(myCmd2);
		}

		//run bat command
		function execCmd(myCmd){
			var exec = require('child_process').exec;
			exec(myCmd,  function (error, stdout, stderr) {
				console.log("run command: "+myCmd);
				//detached: true;
				console.log('stdout: ' + stdout);
				$('#output').append('stdout: ' + stdout)
				if (error !== null) {
				  console.log('exec error: ' + error);
				}
			});
		}

		function cleanFeature(){
			$('#mysort3').empty();
		}

		function removeLastStep(){
			$('#mysort3').children("li:last-child").remove();
		}

		function addNewStep(){
			var stepflag = $('#stepFlag').val().trim();
			var step = $('#stepContent').val().trim();
			console.info("step: "+step+" step flag: "+stepflag);

			var regularExpress = step;
			var reStr = " regularExpress='"+regularExpress+"' ";
			//var flag = ui.draggable.attr('flag');
			var flStr = " flag='"+stepflag+"' ";
			var linkTo = "";
			var linkStr = " linkTo='"+linkTo+"' ";
			var completeStep = step;
			var csStr = " completeStep='"+completeStep+"' ";
			var str = "<li class='list-group-item'"+reStr+flStr+csStr+"></li>"
			console.info("str: "+str);
			var uiText = step.substring(0,60);
			$(str).text(uiText).appendTo( $('#mysort3') );
		}

  </script>
</head>
<body ng-app="myApp">
    <div class="modal-header">
		<h4 class="modal-title">Feature Generate Tool</h4>
    </div>
	<div class="modal-body" ng-controller="stepController">
		<div class="header text-left">
			<b>1. Workspace: </b>
		</div>
		<span class="help-block">Choose the workspace root which run the bdd testing</span>
		<div class="input-group">
			<input id="upload-file-info" placeholder="select the workspace root, such as insight_test..." type="text" class="form-control" disabled="disabled">
			<span class="input-group-btn">
				<button class="btn btn-primary" onclick="$('input[id=save-img]').click()">Choose folder</button>
			</span>
			<span class="input-group-btn">
				<!--button type="button" class="btn btn-success" onclick="readFile($('#upload-file-info').val());">Code analyze</button-->
				<button id="codeAnalyzeBtn" type="button" class="btn btn-success" onclick="codeAnalyze($('#upload-file-info').val());">Code analyze</button>
			</span>
			<!--input id="save-img" onchange='$("#upload-file-info").val($(this).val());' style="display:none" type="file" -->
			<input id="save-img" onchange='$("#upload-file-info").val($(this).val());' style="display:none" type="file" nwdirectory>
		</div>
		<!--div class="progress">
			<div id="codeAnalyzeBar" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
				<span class="sr-only">45% Complete</span>
			</div>
		</div-->

		<div class="header text-left">
			<b>2. Current step: </b>
		</div>
		<span class="help-block">Choose the current step, the default beginning step is loginPageStep</span>
		<select id="stepOptions" class="form-control" style="width:300px" ng-change="updateModel(selected_id)" ng-options="item.path as item.abbr for item in options" ng-model="selected_id" >
			<!--option>loginPageStep mock</option>
			<option>homePageStep mock</option>
			<option>tcrPageStep mock</option>
			<option>p4pPageStep mock</option>
			<option>tsr mock</option-->
		</select>

		<!--div class="dropdown">
			<button id="dLabel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				Custom step
			<span class="caret"></span>
			</button>
			<ul class="dropdown-menu" aria-labelledby="dLabel">
				<li><a href="#">loginPageStep mock</a></li>
				<li><a href="#">homePageStep mock</a></li>
				<li><a href="#">tcrPageStep mock</a></li>
				<li><a href="#">p4pPageStep mock</a></li>
			</ul>
		</div-->

		<div>
			<div class="header text-left">
				<br>
				<b>3. Feature create: </b>
				<button type="button" class="btn btn-default" data-toggle="modal" data-target="#addStepModal" style="position:absolute;left:700px;">
					<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
				</button>
				<button type="button" class="btn btn-default" onclick="removeLastStep();" style="position:absolute;left:750px;">
					<span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
				</button>
				<button type="button" class="btn btn-default" onclick="cleanFeature();" style="position:absolute;left:800px;">
					<span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
				</button>
			</div>
			<div id="container">
				<!--div class="row" style="position:relative;left:13px;"-->
				<div class="row">
					<br>
					<div id="behaviors" class="panel panel-success col-xs-3">
						<div class="panel-heading text-center">BEHAVIOR</div>
						<ul class="list-group" id="mysort1">
							<li class="list-group-item" ng-repeat="x in data | filter:behaviorFilter" flag="{{x.flag}}" methodName="{{x.methodName}}" regularExpress="{{x.regularExpress}}" linkTo="{{x.linkTo}}">
								<!--{{x.methodName.slice(0,20) + '...'}} -->
								{{x.regularExpress.slice(0,60)}}
							</li>
							<!--li class="list-group-item" ng-click="updateModel()"><span class="badge">14</span>login as equilar user</li>
							<li class="list-group-item">login as corporate</li>
							<li class="list-group-item">login as consultant</li>
							<li class="list-group-item">login as ssp</li>
							<li class="list-group-item">login as company override</li-->
						</ul>
					</div>
					<div id="asserts" class="panel panel-warning col-xs-3">
						<div class="panel-heading text-center">ASSERTS</div>
						<ul class="list-group" id="mysort2">
							<li class="list-group-item" ng-repeat="x in data | filter:{flag:'Then'}" flag="{{x.flag}}" methodName="{{x.methodName}}" regularExpress="{{x.regularExpress}}" linkTo="{{x.linkTo}}">
								{{x.regularExpress.slice(0,60)}}
							</li>
							<!--li class="list-group-item">phone number is XXX-XXX-XXXX</li>
							<li class="list-group-item">name is Equilar</li>
							<li class="list-group-item">has login image</li-->
						</ul>
					</div>
					<div id="featureSteps" class="panel panel-info col-xs-3 col-xs-offset-1">
						<div class="panel-heading text-center">FEATURE STEPS</div>
						<ol class="list-group" id="mysort3">
							<!--li class="list-group-item">...</li-->
						</ol>
					</div>
				</div>
			</div>
		</div>

		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			<!--button id="generateBtn" type="button" class="btn btn-primary" onclick="runTest();">Generate feature</button-->
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="generateFeature();">Generate feature</button>
		</div>

		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Generate feature</h4>

			  </div>
			  <div class="modal-body">
				<!--label class="col-sm-2 control-label" for="formGroupInputLarge">Large label</label>
				<div class="col-sm-10">
				  <input class="form-control" type="text" id="formGroupInputLarge" placeholder="Large input">
				</div-->
				<!--textarea id="featureText" class="form-control" rows="10" style="resize:none;">here should display a real time final feature text</textarea-->
				<textarea id="featureText" class="form-control" rows="10" style="resize:none;overflow:fix;">here should display a real time final feature text</textarea>
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button id="saveAs" type="button" class="btn btn-default">Save As</button>
				<button type="button" class="btn btn-primary" onclick="runTest();">Run Test</button>
			  </div>
			</div>
		  </div>
		</div>

		<div class="modal fade" id="reModal" tabindex="-1" role="dialog" aria-labelledby="reModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header" id="reModalHeader">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="reModalLabel">Regular Express Replace</h4>

			  </div>
			  <div class="modal-body" id="replaceLocator">
				 <!--input type="text" class="form-control" id="exampleInputName2" placeholder="Jane Doe"-->
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" onclick="handleRegularExpressString();">Replace</button>
			  </div>
			</div>
		  </div>
		</div>

		<div class="modal fade" id="addStepModal" tabindex="-1" role="dialog" aria-labelledby="addStepModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header" id="addStepModalHeader">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="addStepModalLabel">Add New Step</h4>

			  </div>
			  <div class="modal-body">
				Flag: <input type="text" class="form-control" id="stepFlag" placeholder="enter new step flag: when/then">
				Step: <input type="text" class="form-control" id="stepContent" placeholder="enter new step content">
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" onclick="addNewStep();">Add</button>
			  </div>
			</div>
		  </div>
		</div>

	</div>
</body>
</html>
